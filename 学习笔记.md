# Spring5 框架

## 第一章 Spring框架概述

### 1.1 基本说明

- Spring 是轻量级的开源的 JavaEE 框架
- 其目的主要是解决企业应用开发的复杂性
- Spring 有两个核心部分，IOC 和 Aop
  1. IOC：控制反转，把**创建对象的过程**交给 Spring 进行管理
  2. Aop：面向切面，不修改源代码进行功能增加

### 1.2 特点

1. 方便解耦，简化开发
2. Aop 编程支持
3. 方便程序测试
4. 方便和其他框架进行整合
5. 方便进行实物操作
6. 降低 API 开发难度

### 1.3 入门案例 - 使用 Spring 创建对象 

1. 将以下代码添加到 Maven 工程的 pom.xml文件内

   ```xml
   <properties>
       <spring.version>5.2.6.RELEASE</spring.version>
   </properties>
   <dependencies>
       <!--spring context模块-->
       <dependency>
           <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
           <version>${spring.version}</version>
       </dependency>
   </dependencies>
   ```
   
2. 编写类和对应的方法

3. 在 main/resources/ 目录下创建 xml 格式的 spring 配置文件(name自定义)
   ![image-20200821200527729](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20200821200527729.png)

4. 配置 类的对象创建

   ```xml
   <!-- 
   这里 - 配置Main类对象的创建 
   id：别名
   class：全类名
   -->
   <bean id="main" class="pers.dreamer07.code.Main"></bean>
   ```

5. 在 pom.xml 下引入 junit 单元测试的依赖

   ```xml
   <dependency>
       <groupId>junit</groupId>
       <artifactId>junit</artifactId>
       <version>4.12</version>
       <scope>test</scope>
   </dependency>
   ```

6. 编写测试类和测试方法

   ```java
   @Test
   public void test1(){
       /*
       * 1. 加载 spring 配合文件
       *       ClassPathXmlApplicationContext - 参考编译后 classes文件夹 的路径
       *       FileSystemXmlApplicationContext - 参考 当前工程/模块 路径
       * */
       //ApplicationContext context = new ClassPathXmlApplicationContext("META-INF/bean1.xml");
       ApplicationContext context = new FileSystemXmlApplicationContext("src/main/resources/META-INF/bean1.xml");
   
       //2.读取配置文件中创建的对象
       Main main = context.getBean("main", Main.class);
   
       //3. 调用方法
       main.getEMT();
   }
   ```

## 第二章 IOC 容器

### 2.1 IOC 概念和原理

#### 2.1.1 什么是IOC

1. 控制反转，把 对象创建 和 对象调用 的过程统一交给 Spring 来进行管理
2. 使用 IOC 的目的就是为了 **降低耦合度**
3. 入门案例就是 IOC 实现

#### 2.1.2 IOC底层原理

- 主要使用的技术：xml解析，工厂模式，反射
- 图解 IOC 创建对象的过程
<img src="C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20200822162730106.png" alt="image-20200822162730106" style="zoom:80%;" />

### 2.2 IOC 容器的实现方式

- IOC 基于 IOC 容器完成，而 IOC 容器的底层就是对象工厂

- Spring 提供了 IOC 容器的两种实现方式(对应两个接口)

  1. BeanFactory

     - 开发不常用，IOC 容器的基本实现，是 Spring 内部的使用接口，
     - 加载配置文件时不会创建对象，在是在使用 对应/获取 的对象时再创建对象

  2. ApplicationContext

     - 开发常用，是 BeanFatory 的子接口，提供更多更强大的功能，一般由开发人员进行使用

     - 加载配置文件时，会把文件中配置的对象进行创建

     - 两个实现类

       ClassPathXmlApplicationContext  / FileSystemXmlApplicationContext

### 2.3 IOC 的操作 - Bean 管理

#### 2.3.1 什么是 Bean 管理

1. Spring 创建对象
2. Spring 向创建的对象中注入属性

#### 2.3.2 Bean 管理操作的实现有两种方式

1. 基于xml
2. 基于依赖

### 2.3 IOC 操作 Bean 管理 (基于xml)

#### 2.3.1 基于 xml 方式创建对象

1. 在 spring 的配置文件中使用 \<bean> 标签及其属性配置创建对象的信息
2. bean 标签的常用属性
   - id属性：唯一标识
   - class属性：创建对象对应类的全类名
3. 创建对象时，默认执行无参构造方法 

#### 2.3.2 基于 xml 方式注入属性

##### DI

> 依赖注入，就是注入属性；是IOC中的一种具体实现；但这种注入属性需要在 创建对象的基础 上完成



- Spring 中支持通过两种方式注入属性
  1. 通过set方法注入属性
  2. 通过对应的有参构造器注入属性

##### 使用 xml 的方式 通过 set 方法注入属性

1. 创建类，属性以及对应的 set() 方法

2. 在配置文件 xml 中使用 bean 标签配置要创建对象的类信息

3. 在 bean 标签中，使用 property 标签实现注入属性(该标签会调用对应的set方法)

   - 设置name属性：指定要设置的对象属性
   - 设置value属性：指定要设置的对象属性的属性值

4. ```xml
   <!--举例-->
   <bean name="book" class="pers.dreamer07.code.Book">
       <property name="name" value="喝茶部的养成"></property>
       <property name="author" value="HTT"></property>
   </bean>
   ```

5. 编写测试类和测试方法 

##### 使用 xml 的方式 通过 有参构造函数 注入属性

1. 创建类，属性以及对应的 set() 方法

2. 在配置文件 xml 中使用 bean 标签配置要创建对象的类信息

3. 在 bean 标签中，使用 constructor-arg 标签实现注入属性(该标签会自动填充为对应构造函数的参数值)

   - 设置 name / index 属性：根据构造函数的 形参名/形参的索引(从0开始)
   - 设置 value 属性：对应的参数值

4. ```xml
   <!--举例
   构造函数原型：public Book(String name, String author,Double price)
   -->
   <bean id="book" class="pers.dreamer07.code.Book">
       <constructor-arg name="name" value="喝茶部的养成"></constructor-arg>
       <constructor-arg name="author" value="HTT"></constructor-arg>
       <constructor-arg index="2" value="99.9"></constructor-arg>
   </bean>
   ```

5. 编写测试方法和测试类

##### p 名称空间注入(了解，是对2.3.3的简化操作)

1. 在配置文件中的 beans 标签中添加以下属性

   ```xml
   <beans xmlns:p="http://www.springframework.org/schema/p"></beans>
   ```

2. 在 bean 标签内使用 p 名称空间注入属性(调用set方法)

   ```xml
   <bean id="book" class="pers.dreamer07.code.Book" p:name="喝茶部的养成" p:author="HTT" p:price="99.9"></bean>
   ```

##### 注入空值和特殊符号

- 注入空值，使用 \<null/> 标签

  ```xml
  <!--set方法-->
  <property name="属性名">
  	<null/> <!--注入空值-->
  </property>
  <!--构造方法-->
  <constructor-arg name="属性名">
  	<null/>
  </constructor-arg>
  ```

- 注入特殊符号，使用 \<value>标签

  ```xml
  <!--使用CDATA-->
  <property name="属性名">
  	<value>
      	<![CDATA[属性值]]>
      </value>
  </property>
  ```

##### 注入外部bean

1. 设计两个类 service 类和 dao 类

2. 在 service 中调用 dao 里的方法

3. 在 spring 配置文件中进行以下配置

   ```xml
   <bean id="userService" class="pers.dreamer07.spring5.service.UserService">
   	<!-- 使用ref属性指定外部bean的id -->
       <property name="userDAO" ref="userDAO"></property>
   </bean>
   <!--外部bean-->
   <bean id="userDAO" class="pers.dreamer07.spring5.dao.UserDAO"></bean>
   ```

4. 设计测试类和方法

##### 注入内部 bean 

1. 设计具有一对多关系的两个类 emp(员工类) 和 dept (部门类) 

2. 都重写 toString 方法

3. 在 spring 配置文件中进行以下配置

   ```xml
   <bean id="emp" class="pers.dreamer07.spring5.bean.Emp">
       <property name="name" value="Jack"></property>
       <property name="gender" value="男"></property>
       <property name="dept">
           <!--在内部配置对应的bean对象-->
           <bean id="dept" class="pers.dreamer07.spring5.bean.Dept">
               <property name="dname" value="IT"></property>
           </bean>
       </property>
   </bean>
   ```

4. 设计测试类和方法

##### 级联赋值

> 当两个 bean 关联时，通过一个 bean 给另一个 bean 里的属性赋值

1. 设计具有一对多关系的两个类 emp(员工类) 和 dept (部门类) 

2. 都重写 toString 方法

3. 可以通过两种方式完成

   3.1 注入外部bean的同时，通过外部bean完成对其自身的属性赋值

   ```xml
   <bean id="emp" class="pers.dreamer07.spring5.bean.Emp">
       <property name="name" value="Jack"></property>
       <property name="gender" value="男"></property>
       <property name="dept" ref="dept"></property>
   </bean>
   <bean id="dept" class="pers.dreamer07.spring5.bean.Dept">
       <!--方式1：注入外部bean的同时，通过外部bean完成对其的属性赋值-->
       <property name="dname" value="级联赋值1"></property>
   </bean>
   ```

   3.2 注入外部bean时，通过内部调用其属性完成赋值
   	   注意：内部级联赋值需要对应的bean属性具有get方法

   ```xml
   <bean id="emp" class="pers.dreamer07.spring5.bean.Emp">
       <property name="name" value="Jack"></property>
       <property name="gender" value="男"></property>
       <property name="dept" ref="dept"></property>
       <!--方式2：注入外部bean时，通过内部调用其属性完成赋值
               注意 - 内部级联赋值需要对应的bean属性具有get方法
           -->
       <property name="dept.dname" value="OHHH"></property>
   </bean>
   <bean id="dept" class="pers.dreamer07.spring5.bean.Dept"></bean>
   ```

##### 注入四种集合(数组，List，Set，Map)类型属性 - 基本使用

1. 设计类以及对应的属性和set方法

2. 重写 toString 方法

3. 在 xml 中配置对应的属性

   ```xml
   <!--配置需要创建的对象-->
   <bean id="stu" class="pers.dreamer07.spring5.coll_map.Stu">
       <!--数组属性-->
       <property name="arr">
           <!--<list>标签和<array>标签都可以-->
           <array>
               <value>砸我鲁多</value>
               <value>邪王真眼！！</value>
           </array>
       </property>
       <!--list集合属性-->
       <property name="list">
           <!--<list>标签和<array>标签都可以-->
           <list>
               <value>AAA</value>
               <value>BBB</value>
               <value>BBB</value>
           </list>
       </property>
       <!--set集合属性-->
       <property name="set">
           <set>
               <value>CCC</value>
               <value>CCC</value>
           </set>
       </property>
       <!--map集合属性-->
       <property name="map">
           <map>
               <!--使用entry标签，设置key和value属性-->
               <entry key="E" value="EMT!"></entry>
               <entry key="M" value="EMT!!"></entry>
               <entry key="T" value="EMT!!!"></entry>
           </map>
       </property>
   </bean>
   ```

4. 设计测试类和方法

##### 注入四种集合(数组，List，Set，Map)类型属性 - 进阶使用

- 集合元素类型为对象类型
- 把集合注入部分提取出来

### 2.4 IOC 操作 Bean 管理(基于注解)